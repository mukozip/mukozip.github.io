<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dairy Full Advanced System</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/4.4.0/chart.umd.min.js"></script>

<style>
body{font-family:system-ui;margin:20px}
.controls{margin-bottom:15px;display:flex;gap:15px;flex-wrap:wrap}
table{border-collapse:collapse;font-size:0.8rem;width:100%;display:block;overflow-x:auto}
th,td{border:1px solid #ccc;padding:4px;text-align:center}
thead th{background:#eee;position:sticky;top:0}
th:first-child,td:first-child{position:sticky;left:0;background:#f9f9f9;text-align:left}
input{width:55px}
.dashboard{display:flex;gap:40px;margin-bottom:20px;flex-wrap:wrap}
canvas{max-width:600px}
</style>
</head>

<body>

<h2>üêÑ Dairy Production Management System</h2>

<div class="controls">
<label>Year:
<select id="yearSel">
<option>2024</option>
<option>2025</option>
<option selected>2026</option>
</select></label>

<label>Month:
<select id="monthSel">
<option>January</option><option>February</option><option>March</option>
<option>April</option><option>May</option><option>June</option>
<option>July</option><option>August</option><option>September</option>
<option>October</option><option>November</option><option>December</option>
</select></label>

<button onclick="save()">Save</button>
<button onclick="render()">Reload</button>
<button onclick="localStorage.clear();location.reload()">Reset All</button>
</div>

<h3>üìä Monthly Dashboard</h3>
<div class="dashboard">
<div>
<h4 style="color:green">üèÜ Top 5</h4>
<ol id="topList"></ol>
</div>

<div>
<h4 style="color:red">üìâ Lowest 5</h4>
<ol id="lowList"></ol>
</div>

<div>
<h4>ü•á Best Cow</h4>
<div id="bestCow"></div>
</div>
</div>

<canvas id="chart"></canvas>

<br><br>

<table id="tbl">
<caption id="caption"></caption>
<thead><tr id="headerRow"></tr></thead>
<tbody></tbody>
<tfoot>
<tr id="dailyRow"></tr>
<tr id="homeRow"></tr>
<tr id="workerRow"></tr>
<tr id="calfAMRow"></tr>
<tr id="calfPMRow"></tr>
<tr id="finalRow"></tr>
</tfoot>
</table>

<script>

const MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"];
let year=2026;
let month="January";

let cows=[
{no:"093",name:"RITAH",calving:"2024-05-28",preg:""},
{no:"434",name:"SHANA",calving:"2024-10-06",preg:"1.6"},
{no:"083",name:"KATHY",calving:"2024-10-27",preg:""},
{no:"402",name:"KELLEN",calving:"2024-11-13",preg:""},
{no:"098",name:"JACKLINE",calving:"2025-04-12",preg:"0"},
{no:"421",name:"EVA",calving:"2025-05-17",preg:"0"},
{no:"099",name:"SARAH",calving:"2025-04-20",preg:"0"},
{no:"521",name:"KEZA",calving:"2025-03-11",preg:"0"},
{no:"539",name:"KIRABO",calving:"2025-04-25",preg:"0"},
{no:"403",name:"PEACE",calving:"2025-05-10",preg:"0"},
{no:"418",name:"IRENE",calving:"2025-05-17",preg:"0"},
{no:"296",name:"JOAN",calving:"2025-05-28",preg:"0"},
{no:"511",name:"SIIMA",calving:"2025-06-22",preg:"0"},
{no:"021",name:"BIIRA",calving:"2025-06-24",preg:"0"},
{no:"502",name:"RUTH",calving:"2024-07-07",preg:"0"},
{no:"010",name:"DEBRA",calving:"2025-07-08",preg:"0"},
{no:"516",name:"NAKATO",calving:"2025-07-19",preg:"0"},
{no:"535",name:"FIONA",calving:"2025-07-21",preg:"0"},
{no:"134",name:"BEATRICE",calving:"2025-08-02",preg:"0"},
{no:"011",name:"NINA",calving:"2025-08-04",preg:"0"},
{no:"100",name:"KARUNGI",calving:"2025-07-09",preg:"0"},
{no:"935",name:"PROSSY",calving:"2025-08-23",preg:"0"},
{no:"404",name:"KYOOZI",calving:"2025-08-28",preg:"0"},
{no:"013",name:"BELLA",calving:"2025-09-05",preg:"0"},
{no:"425",name:"ANGEL",calving:"2025-11-02",preg:"0"},
{no:"297",name:"MERCY",calving:"2025-11-30",preg:"0"}
];

let state=JSON.parse(localStorage.getItem("dairyFullData"))||{};

function init(){
const key=year+"_"+month;
if(!state[key]){
const days=new Date(year,MONTHS.indexOf(month)+1,0).getDate();
state[key]={
prod:cows.map(()=>({am:Array(days).fill(""),pm:Array(days).fill("")})),
ded:{
home:Array(days).fill(""),
worker:Array(days).fill(""),
calfAM:Array(days).fill(""),
calfPM:Array(days).fill("")
}
};
}
return state[key];
}

function render(){
const data=init();
const days=new Date(year,MONTHS.indexOf(month)+1,0).getDate();
document.getElementById("caption").innerText=month+" "+year;

const header=document.getElementById("headerRow");
header.innerHTML="<th>Cow</th><th>Calving</th><th>Preg</th>";
for(let d=1;d<=days;d++){
header.innerHTML+=`<th>${d}<br>AM</th><th>${d}<br>PM</th>`;
}
header.innerHTML+="<th>Total</th>";

const tbody=document.querySelector("tbody");
tbody.innerHTML="";
let totals=[];

cows.forEach((cow,i)=>{
let row=`<tr>
<td>${cow.no} ${cow.name}</td>
<td>${cow.calving}</td>
<td>${cow.preg}</td>`;
let total=0;

for(let d=0;d<days;d++){
let am=data.prod[i].am[d]||"";
let pm=data.prod[i].pm[d]||"";
total+=(+am||0)+(+pm||0);
row+=`<td><input type="number" step="0.1" value="${am}" onchange="updateProd(${i},${d},'am',this.value)"></td>
<td><input type="number" step="0.1" value="${pm}" onchange="updateProd(${i},${d},'pm',this.value)"></td>`;
}
row+=`<td>${total.toFixed(1)}</td></tr>`;
tbody.innerHTML+=row;
totals.push({name:cow.name,total});
});

updateFooter(days,data,totals);
updateDashboard(totals,days);
}

function updateProd(i,d,type,val){
state[year+"_"+month].prod[i][type][d]=val;
save();
render();
}

function updateFooter(days,data,totals){
let daily=Array(days).fill(0);
totals.forEach((c,i)=>{
for(let d=0;d<days;d++){
daily[d]+=(+data.prod[i].am[d]||0)+(+data.prod[i].pm[d]||0);
}
});

let dailyRow="<td>Daily Total</td><td></td><td></td>";
daily.forEach(v=>dailyRow+=`<td colspan="2">${v.toFixed(1)}</td>`);
dailyRow+=`<td>${daily.reduce((a,b)=>a+b,0).toFixed(1)}</td>`;
document.getElementById("dailyRow").innerHTML=dailyRow;

buildDedRow("homeRow","Home Use","home",days,data);
buildDedRow("workerRow","Workers","worker",days,data);
buildDedRow("calfAMRow","Calf AM","calfAM",days,data);
buildDedRow("calfPMRow","Calf PM","calfPM",days,data);

let milkTotal=daily.reduce((a,b)=>a+b,0);
let dedTotal=0;
Object.values(data.ded).forEach(arr=>arr.forEach(v=>dedTotal+=+v||0));
let final=milkTotal-dedTotal;

document.getElementById("finalRow").innerHTML=
`<td>Final Total</td><td></td><td></td>`+
Array(days*2).fill("<td></td>").join("")+
`<td>${final.toFixed(1)}</td>`;
}

function buildDedRow(id,label,key,days,data){
let row=`<td>${label}</td><td></td><td></td>`;
let total=0;
for(let d=0;d<days;d++){
let val=data.ded[key][d]||"";
total+=+val||0;
row+=`<td colspan="2">
<input type="number" step="0.1" value="${val}" onchange="updateDed('${key}',${d},this.value)">
</td>`;
}
row+=`<td>${total.toFixed(1)}</td>`;
document.getElementById(id).innerHTML=row;
}

function updateDed(key,d,val){
state[year+"_"+month].ded[key][d]=val;
save();
render();
}

let chart;
function updateDashboard(totals,days){
totals.sort((a,b)=>b.total-a.total);

let top=totals.slice(0,5);
let low=totals.slice(-5).reverse();

document.getElementById("topList").innerHTML=
top.map(c=>`<li>${c.name} ‚Äî ${c.total.toFixed(1)} L (Avg ${(c.total/days).toFixed(2)})</li>`).join("");

document.getElementById("lowList").innerHTML=
low.map(c=>`<li>${c.name} ‚Äî ${c.total.toFixed(1)} L</li>`).join("");

document.getElementById("bestCow").innerHTML=
`<strong>${top[0].name}</strong><br>Total: ${top[0].total.toFixed(1)} L<br>Average: ${(top[0].total/days).toFixed(2)} L/day`;

if(chart) chart.destroy();
chart=new Chart(document.getElementById("chart"),{
type:'bar',
data:{
labels:top.map(c=>c.name),
datasets:[{label:'Top 5 Production (Litres)',data:top.map(c=>c.total)}]
}
});
}

function save(){
localStorage.setItem("dairyFullData",JSON.stringify(state));
}

document.getElementById("yearSel").onchange=e=>{year=+e.target.value;render();}
document.getElementById("monthSel").onchange=e=>{month=e.target.value;render();}

render();

</script>
</body>
</html>
