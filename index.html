<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Dairy Management App</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
<div id="root"></div>

<script>
    // ===== Firebase Config (Replace with your own if using Firebase) =====
    window.__firebase_config = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_PROJECT_ID.appspot.com",
        messagingSenderId: "YOUR_SENDER_ID",
        appId: "YOUR_APP_ID"
    };

    // ===== Local Cow Data =====
    const initialCows = [
        { id: 1, name: "Aminata", lastCalvingDate: "2025-05-01" },
        { id: 2, name: "Biram", lastCalvingDate: "2025-04-15" },
        { id: 3, name: "Clara", lastCalvingDate: "2025-06-10" },
        { id: 4, name: "Daisy", lastCalvingDate: "2025-03-25" },
        { id: 5, name: "Elsie", lastCalvingDate: "2025-05-20" },
        { id: 6, name: "Fiona", lastCalvingDate: "2025-02-14" },
        { id: 7, name: "Grace", lastCalvingDate: "2025-06-01" },
        { id: 8, name: "Hilda", lastCalvingDate: "2025-04-05" },
        { id: 9, name: "Isabel", lastCalvingDate: "2025-01-12" },
        { id: 10, name: "Joy", lastCalvingDate: "2025-07-01" },
        { id: 11, name: "Kira", lastCalvingDate: "2025-05-30" }
    ];

    // ===== Destructure Recharts correctly =====
    const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = window.Recharts;

    // ===== Simple App (React) =====
    function App() {
        const [cow, setCow] = React.useState(initialCows[0].name);
        const [date, setDate] = React.useState(new Date().toISOString().split("T")[0]);
        const [am, setAm] = React.useState("");
        const [pm, setPm] = React.useState("");
        const [data, setData] = React.useState([]);

        React.useEffect(() => {
            const saved = JSON.parse(localStorage.getItem("milkData") || "[]");
            setData(saved);
        }, []);

        const saveEntry = () => {
            const entry = { cow, date, am: parseFloat(am) || 0, pm: parseFloat(pm) || 0 };
            const newData = [...data, entry];
            setData(newData);
            localStorage.setItem("milkData", JSON.stringify(newData));
            setAm("");
            setPm("");
        };

        const aggregateData = () => {
            const totals = {};
            data.forEach(e => {
                if (!totals[e.cow]) totals[e.cow] = 0;
                totals[e.cow] += e.am + e.pm;
            });
            return Object.entries(totals).map(([name, total]) => ({ name, total }));
        };

        const top5 = aggregateData().sort((a,b) => b.total - a.total).slice(0,5);

        return (
            <div style={{ padding: "20px", fontFamily: "Arial" }}>
                <h2>Dairy Management</h2>
                <div>
                    <label>Cow: </label>
                    <select value={cow} onChange={e => setCow(e.target.value)}>
                        {initialCows.map(c => <option key={c.id}>{c.name}</option>)}
                    </select>
                </div>
                <div>
                    <label>Date: </label>
                    <input type="date" value={date} onChange={e => setDate(e.target.value)} />
                </div>
                <div>
                    <label>AM (L): </label>
                    <input type="number" value={am} onChange={e => setAm(e.target.value)} />
                </div>
                <div>
                    <label>PM (L): </label>
                    <input type="number" value={pm} onChange={e => setPm(e.target.value)} />
                </div>
                <button onClick={saveEntry}>Save</button>

                <h3>Top 5 Cows (Total Milk)</h3>
                <ResponsiveContainer width="100%" height={300}>
                    <BarChart data={top5}>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="name" />
                        <YAxis />
                        <Tooltip />
                        <Legend />
                        <Bar dataKey="total" fill="#8884d8" />
                    </BarChart>
                </ResponsiveContainer>
            </div>
        );
    }

    ReactDOM.render(<App />, document.getElementById("root"));
</script>
</body>
</html>
